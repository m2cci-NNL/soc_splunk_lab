[armada_itsm_so]
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
search = | inputlookup incident_details_so \
| dedup modification_time,number \
| search "Service Offering"="armada" \
| eval \
    in_progress = if(status="In Progress",number,false) ,\
    created=if(status="New",number,false),\
    solved = if(status="Resolved",number,false),\
    closed = if(status="Closed",number,false),\
    hold = if(status="On Hold",number,false),\
    cancel = if(status="Cancelled",number,false),\
    total=number,\
    modification_time=trim(strftime(strptime(modification_time,"%m/%d/%Y"),"%Y-%m-%d")) \
| stats count(in_progress) as in_progress , count(closed) as closed, count(created) as created, count(hold) as hold, count(solved) as solved, count(cancel) as cancel,count(total) as total by modification_time \
| sort -modification_time \
| eval mode_now=strptime(strftime(now(),"%Y-%m-%d"),"%Y-%m-%d"), mode=strptime(modification_time,"%Y-%m-%d") , now=if(mode_now = mode,1,0) ,\
    mode_yesterday=strptime(strftime(relative_time(now(), "-1d"),"%Y-%m-%d"),"%Y-%m-%d") , yes=if(mode_yesterday = mode,1,0) \
| search yes=1 OR now=1 \
| eval today_time= strftime(time() ,"%Y-%m-%d") \
| eval today= strptime(today_time ,"%Y-%m-%d"), mod=strptime(modification_time,"%Y-%m-%d") \
| eval todaytime=if(mod=today,today_time,"no") \
| eval today_in_progress = if(todaytime!="no",in_progress,0),\
    prev_in_progress=if(todaytime="no",in_progress,0),\
    today_created = if(todaytime!="no",created,0),\
    prev_created=if(todaytime="no",created,0),\
    today_solved = if(todaytime!="no",solved,0),\
    prev_solved=if(todaytime="no",solved,0),\
    today_closed = if(todaytime!="no",closed,0),\
    prev_closed=if(todaytime="no",closed,0),\
    today_hold = if(todaytime!="no",hold,0),\
    prev_hold=if(todaytime="no",hold,0),\
    today_cancel = if(todaytime!="no",cancel,0),\
    prev_cancel=if(todaytime="no",cancel,0) ,\
    today_total = if(todaytime!="no",total,0),\
    prev_total=if(todaytime="no",total,0) \
| fields today_in_progress, prev_in_progress, today_created,prev_created,today_solved,prev_solved,today_closed,prev_closed,today_hold,prev_hold,today_cancel,prev_cancel,today_total,prev_total \
| stats sum(today_in_progress) as today_in_progress, sum(prev_in_progress) as prev_in_progress,sum(today_created) as today_created ,sum(prev_created) as prev_created,sum(today_solved) as today_solved ,sum(prev_solved) as prev_solved,sum(today_closed) as today_closed ,sum(prev_closed) as prev_closed,sum(today_hold) as today_hold,sum(prev_hold) as prev_hold,sum(today_cancel) as today_cancel,sum(prev_cancel) as prev_cancel,sum(today_total) as today_total,sum(prev_total) as prev_total \
| eval ChangePercent_in_progress= case(prev_in_progress = today_in_progress,"0",like(prev_in_progress,"0") AND prev_in_progress!= today_in_progress ,"N/A",true(),round((today_in_progress - prev_in_progress ) / prev_in_progress * 100,0)), ChangePercent_in_progress=if(ChangePercent_in_progress > 0,"+".ChangePercent_in_progress,ChangePercent_in_progress),\
    ChangePercent_created= case(prev_created = today_created,"0",like(prev_created,"0") AND prev_created!= today_created ,"N/A",true(),round((today_created - prev_created ) / prev_created * 100,0)), ChangePercent_created=if(ChangePercent_created > 0,"+".ChangePercent_created,ChangePercent_created),\
    ChangePercent_solved= case(prev_solved = today_solved,"0",like(prev_solved,"0") AND prev_solved!= today_solved ,"N/A",true(),round((today_solved - prev_solved ) / prev_solved * 100,0)), ChangePercent_solved=if(ChangePercent_solved > 0,"+".ChangePercent_solved,ChangePercent_solved)\
    ,ChangePercent_closed= case(prev_closed = today_closed,"0",like(prev_closed,"0") AND prev_closed!= today_closed ,"N/A",true(),round((today_closed - prev_closed ) / prev_closed * 100,0)), ChangePercent_closed=if(ChangePercent_closed > 0,"+".ChangePercent_closed,ChangePercent_closed)\
    ,ChangePercent_hold= case(prev_hold = today_hold,"0",like(prev_hold,"0") AND prev_hold!= today_hold ,"N/A",true(),round((today_hold - prev_hold ) / prev_hold * 100,0)), ChangePercent_hold=if(ChangePercent_hold > 0,"+".ChangePercent_hold,ChangePercent_hold)\
    , ChangePercent_cancel= case(prev_cancel = today_cancel,"0",like(prev_cancel,"0") AND prev_cancel!= today_cancel ,"N/A",true(),round((today_cancel - prev_cancel ) / prev_cancel * 100,0)), ChangePercent_cancel=if(ChangePercent_cancel > 0,"+".ChangePercent_cancel,ChangePercent_cancel)\
    , ChangePercent_total= case(prev_total = today_total,"0",like(prev_total,"0") AND prev_total!= today_total ,"N/A",true(),round((today_total - prev_total ) / prev_total * 100,0)), ChangePercent_total=if(ChangePercent_total > 0,"+".ChangePercent_total,ChangePercent_total)

[armada_wise_list_servers]
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
search = [ | inputlookup ci_so_mapping_rep | dedup name\
 | search SO="armada" OR name=*XSPH10C121B*\
| eval host_name=name\
, search = "| PING ".host_name.".pharma.aventis.com | rename host as host_name " | table search| mvcombine search delim="| append ["\
| nomv search\
| eval search = " makeresults | append [ ".replace(search,"(host_name)"," host_name ] ") ] \
| table host_name, packet_loss\
| eval Hostname= mvindex(split(host_name,"."),0)\
| eval status=case(packet_loss=0,"Online",packet_loss>0,"Offline")\
| eval color_value=if(status="Offline","#dc3545","#5cb85c"),icon_value="server"\
| stats values(status) as status , values(icon_value) as icon_value , values(color_value) as color_value by Hostname\
| sort Hostname\
| outputlookup armada_list_servers.csv

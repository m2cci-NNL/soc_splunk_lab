<form version="1.1" hideExport="true" stylesheet="website_monitoring:status_overview.css" script="website_monitoring:status_overview.js">
  <label>Application Performance</label>
  <!--<row>
    <panel>
      <title>Alert status from CtrlM per job</title>
      <input type="text" token="job_name" id="input1">
        <label>Job name</label>
        <default>*</default>
      </input>
      <table>
        <search id="search_logic">
          <progress>
            <condition match="$job.resultCount$ == 0">
              <set token="show_html"></set>
            </condition>
          </progress>
          <query>index=sag_scheduling_normal *armada*
| table _time job_name message status application sub_application  memname  source *
| stats latest(run_as) as run_as,latest(message) as message latest(_time) as time, latest(status) as status,latest(application) as application, latest(sub_application) as sub_application, latest(data_center) as data_center, latest(source) as source,latest(host_id) as host_id by job_name
| fields message time job_name status,application,sub_application, source,data_center ,run_as,host_id
 | eval colour=case(message="Ended not OK","#FF0000",message="Ended OK","#008000"), time=if(time="",now(),time) , status=if(isnull(status),"",status) | convert ctime(*time)
 | table run_as,job_name,data_center,application,sub_application,source,time,message,host_id | search job_name="$job_name$"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="message">
          <colorPalette type="expression">case (match(value,"Ended OK"), "#008000",match(value,"Ended not OK") OR like(value,"%FAILED%"), "#FF0000",true(),"white")</colorPalette>
        </format>
      </table>
      <html depends="$show_html$">
        <p style="color:green;margin-left:30px;font-size:15px;">If there is no results means &gt; No alerts from CTRLM related to ARMADA &gt; all jobs runing fine in CTRLM</p>
      </html>
    </panel>
  </row>-->
  <!-- <row>
    <panel>
      <title>Job execution details</title>
      <table>
        <search>
          <query>index=sag_windows_normal  source="c:\\Program Files\\SplunkUniversalForwarder\\etc\\apps\\Windows_File_Folder_Monitoring\\bin\\main.bat" *Armada*
| rex field=_raw "Computername\:\-\s+(?&lt;ComputerName&gt;\w+)\s+Current\sPath\s\:\-\s+(?&lt;CurrentPath&gt;.*)\s+File\sAge\s\:\-\s+(?&lt;FileAge&gt;.*)"
| rex field=_raw "FolderPath.*\s+.*[\r\n]+(?&lt;FolderPath&gt;[^\s]+)\s(?&lt;FolderName&gt;[^\s]+)\s+(?&lt;sizeKB&gt;[^\s]+)\s+(?&lt;sizeMB&gt;[^\s]+)\s+(?&lt;sizeGB&gt;[^\s]+)" 
| stats  values(FileAge) as FileAge,values(FolderPath) as FolderPath,values(FolderName) as FolderName,values(sizeKB) as sizeKB,values(sizeMB) as sizeMB,values(sizeGB) as sizeGB by ComputerName,CurrentPath</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="CurrentPath">
          <colorPalette type="list">[#dbf0f9]</colorPalette>
        </format>
        <format type="color" field="FolderPath">
          <colorPalette type="list">[#dbf0f9]</colorPalette>
        </format>
        <format type="color" field="FolderName">
          <colorPalette type="list">[#dbf0f9]</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Job execution over time</title>
      <chart>
        <search>
          <query>index=sag_windows_normal  source="c:\\Program Files\\SplunkUniversalForwarder\\etc\\apps\\Windows_File_Folder_Monitoring\\bin\\main.bat" *Armada*
| rex field=_raw "Computername\:\-\s+(?&lt;ComputerName&gt;\w+)\s+Current\sPath\s\:\-\s+(?&lt;CurrentPath&gt;.*)\s+File\sAge\s\:\-\s+(?&lt;FileAge&gt;.*)"
| rex field=_raw "FolderPath.*\s+.*[\r\n]+(?&lt;FolderPath&gt;[^\s]+)\s(?&lt;FolderName&gt;[^\s]+)\s+(?&lt;sizeKB&gt;[^\s]+)\s+(?&lt;sizeMB&gt;[^\s]+)\s+(?&lt;sizeGB&gt;[^\s]+)" 
| bin span=1h _time
| chart values(sizeKB) as sizeKB,values(sizeMB) as sizeMB,values(sizeGB) as sizeGB by _time,FolderPath</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="height">319</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>-->
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="field1">
      <label>Select Time Range (CET)</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <!--row>
    <panel>
      <title>Website monitoring</title>
      <table>
        <search>
          <query>(index=sag_connectivity_normal source="web_ping*") 
| eval response_code=(case((timed_out == "True"),"Connection timed out",(isnull(response_code) OR (response_code == "")),"Connection failed",true(),response_code) . coalesce((" " . has_expected_string),"")), error_threshold=coalesce(error_threshold,1000), warning_threshold=coalesce(warning_threshold,800), status=case(((((((((response_code &gt;= 400) OR (total_time &gt;= error_threshold)) OR (response_code == "*false")) OR (response_code == "Connection failed")) OR (response_code == "Connection timed out")) OR (timed_out == True)) OR (response_code == "")) OR (has_expected_string == "false")),"Failed",(total_time &gt;= warning_threshold),"Warning",true(),"OK") 
| stats sparkline(avg(total_time)) as sparkline_response_time avg(total_time) as avg_response_time max(total_time) as max_response_time latest(response_code) as response_code latest(_time) as last_checked latest(title) as title latest(url) as url latest(total_time) as response_time range(total_time) as range min(total_time) as min latest(status) as status by source 
| search 
    [| inputlookup armada_list_servers.csv 
    | dedup Hostname 
    | table Hostname 
    | mvcombine Hostname delim="*\" OR url=\"*" 
    | nomv Hostname 
    | eval search="url=\"".Hostname."*\"" 
    | table search] OR (title="*armada*" OR url="armada*") AND title !=armada_url*
| eval response_time=(round(response_time,0) . " ms"), average=(round(avg_response_time,0) . " ms"), maximum=(round(max_response_time,0) . " ms"), range=(((round(min,0) . " - ") . round((min + range),0)) . " ms"), response=response_code 
| table  url, response, last_checked, response_time, status, average, range, sparkline_response_time 
| eval now=time(), last_checked=case((last_checked &gt; now),"0 minutes ago",((now - last_checked) &gt; 172800),(round(((now - last_checked) / 86400)) . " days ago"),((now - last_checked) &gt; 7200),(round(((now - last_checked) / 3600)) . " hours ago"),((now - last_checked) &gt; 120),(round(((now - last_checked) / 60)) . " minutes ago"),((now - last_checked) &gt; 60),"1 minute ago",((now - last_checked) &lt;= 60),"just now") 
| fields - now 
| sort -response_time</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">20</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <format field="sparkline_response_time" type="sparkline">
          <option name="type">bar</option>
          <option name="height">20</option>
          <option name="barColor">#65a637</option>
          <option name="fillColor">#65a637</option>
          <option name="lineColor">#65a637</option>
          <option name="spotColor">#65a637</option>
          <option name="colorMap">
            <option name="800:1000">#f2b827</option>
            <option name="1000:">#d6563c</option>
          </option>
        </format>
        <drilldown>
          <link target="_blank"><![CDATA[/app/website_monitoring/status_history?form.title=$row.Title$&earliest=$earliest$&latest=$latest$]]></link>
        </drilldown>
      </table>
    </panel>
  </row>-->
  <row>
    <panel id="panel1">
      <!--<title>Web Errors</title>-->
      <html>
         <style>
           /* To change gray body color at the bottom of the dashboard */
              body {
              background-color: white !important;
                  }
                  
                   /* To hide the real-time menu */
          div[data-test-panel-id="realTime"] {
             display: none;
         }
           /*css to hide "i" icon*/
           .sc-hMqMXs.kmLQSk
            {
         display:none !important;
            }
            /* To put space before filter */
      .fieldset .input {
       margin-left:-1% !important;
       margin-bottom:1% !important;
        
        }
		/* To put space in the left/right of panels */ 
  .dashboard-body {
             background-color: white;
             padding: 0% 1% 0% 1% !important;
			
              }
 /* To add borderline color*/      
            .dashboard-panel{
              border: 1px #19367c solid;
             }  
           /* Hide error popup*/
           
           [data-test="toast-messages"] {
            display: none !important;
              }
              
           /* To hide ... button*/
            
        .dashboard-header .dashboard-menu .edit-other {
	          display:none !important;
             } 
           
             h1  {
    color: #434392;
    }
              .dashboard-row .dashboard-panel h2.panel-title { 
             font-size: 15px !important; 
  color:white; 
  font-weight: Bold; 
  background-color: #515ba2; 
  margin-bottom:1%;
           } 
          div#fieldset1 {margin-bottom:1% !important;
          }
           .dashboard-panel h2{
             background:#19367c !important;
              border:1px solid #19367c;
             color:white !important;
             text-align: center !important;
           }
           #border.dashboard-cell.dashboard-layout-panel{
            border-style: solid;
              border-width: 4px;
              border-color: black;
            width :49% !important;!important;
           }
           #panel1.dashboard-cell.dashboard-layout-panel{
               width :29% !important;!important;
           }
		     #panel5.dashboard-cell.dashboard-layout-panel{
               
              width:70.75% !important;
               margin-left:0.25% !important;
           }

           #panel6.dashboard-cell.dashboard-layout-panel{
               width :35% !important;!important;
               height :180px !important;
           }
           #panel7.dashboard-cell.dashboard-layout-panel{
			   width :35% !important;!important;
			   height :160px !important;
           }
            #panel8.dashboard-cell.dashboard-layout-panel{
			   width :35% !important;!important;
			   height :160px !important;
           }
             #panel9.dashboard-cell.dashboard-layout-panel{
			
        	margin-top : 0.8% !important ;
           }
           
            #panel10.dashboard-cell.dashboard-layout-panel{
			    	margin-top : 0.8% !important ;
           }
            #panel11.dashboard-cell.dashboard-layout-panel{
			   width :45% !important;!important;
			   height :100px !important;
           }
           
            [data-view="views/shared/appbar/Button"] [data-role="label"] {
            color: white;
            font-size: 1rem;
             font-weight: 500;
            }
          
          [data-view="views/shared/Icon"][data-icon="triangleDownSmall"] {
            color: white;
            }
        
            h1.dashboard-title{
          color: #19367c !important; 
          margin-left:-1% !important;}
          
           div[data-view="views/shared/appbar/Master"] {
             background-color: white;
             border-bottom: solid white;
             border-top: solid white;
             background-color:#19367c;
             }
             
              [data-role="app-name"] {
             color: white;
            
              font-weight: 1000;
            }

  [data-role="underline"] {
            background-color: silver !important;
            top: 34px;
            }
			i.icon-alert {
            visibility: hidden;

            }
            .alert {
            visibility: hidden;
            }
         </style>
       </html>
      <viz type="status_indicator_app.status_indicator">
        <title>Transactions Available (OK)</title>
        <search>
          <query>index=sag_common_hpbsm NAME_APPLICATION="armada"  AVAILABILITY="100"
|  stats latest(AVAILABILITY) as AVAILABILITY, latest(RESPONSE_TIME) as RESPONSE_TIME by NAME_APPLICATION, NAME_BTF, NAME_LOCATION,NAME_TRANSACTION
|  rename NME_BTF as "Business process", NAME_TRANSACTION as "Transaction name"
 | stats count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">all</option>
        <option name="height">110</option>
        <option name="refresh.display">progressbar</option>
        <option name="status_indicator_app.status_indicator.colorBy">static_color</option>
        <option name="status_indicator_app.status_indicator.fillTarget">background</option>
        <option name="status_indicator_app.status_indicator.fixIcon">check</option>
        <option name="status_indicator_app.status_indicator.icon">fix_icon</option>
        <option name="status_indicator_app.status_indicator.precision">0</option>
        <option name="status_indicator_app.status_indicator.showOption">1</option>
        <option name="status_indicator_app.status_indicator.staticColor">#53a051</option>
        <option name="status_indicator_app.status_indicator.useColors">true</option>
        <option name="status_indicator_app.status_indicator.useThousandSeparator">true</option>
      </viz>
      <viz type="status_indicator_app.status_indicator">
        <title>Transactions not Available (KO)</title>
        <search>
          <query>index=sag_common_hpbsm NAME_APPLICATION="armada"  AVAILABILITY="0"
|  stats latest(AVAILABILITY) as AVAILABILITY, latest(RESPONSE_TIME) as RESPONSE_TIME by NAME_APPLICATION, NAME_BTF, NAME_LOCATION,NAME_TRANSACTION
|  rename NME_BTF as "Business process", NAME_TRANSACTION as "Transaction name"
 | stats count    | eval icon=if( count=0, "check","warning") , color = if( count=0, "#53a051","#dc4e41") | table count, icon, color</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">all</option>
        <option name="height">110</option>
        <option name="refresh.display">progressbar</option>
        <option name="status_indicator_app.status_indicator.colorBy">field_value</option>
        <option name="status_indicator_app.status_indicator.fillTarget">background</option>
        <option name="status_indicator_app.status_indicator.fixIcon">warning</option>
        <option name="status_indicator_app.status_indicator.icon">field_value</option>
        <option name="status_indicator_app.status_indicator.precision">0</option>
        <option name="status_indicator_app.status_indicator.showOption">1</option>
        <option name="status_indicator_app.status_indicator.staticColor">#dc4e41</option>
        <option name="status_indicator_app.status_indicator.useThousandSeparator">true</option>
      </viz>
    </panel>
    <panel id="panel5">
      <title>Transaction details</title>
      <table>
        <search>
          <query>index=sag_common_hpbsm NAME_APPLICATION="armada" AVAILABILITY="100" 
| stats latest(_time) as Time latest(AVAILABILITY) as AVAILABILITY, latest(RESPONSE_TIME) as RESPONSE_TIME by NAME_APPLICATION, NAME_BTF, NAME_LOCATION,NAME_TRANSACTION 
| rename NAME_BTF as "Business process", NAME_TRANSACTION as "Transaction name",NAME_LOCATION as "Location name" , NAME_APPLICATION as "Application name" 
| fields - RESPONSE_TIME 
| eval icon = "icon|" + if(AVAILABILITY=="100", "ico_good ico_small|icon-check|Up", "ico_error ico_small|icon-close|Down") 
| rename icon as " " 
|convert ctime(Time) as Time</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="Application name">
          <colorPalette type="list">["#87ceeb"]</colorPalette>
        </format>
      </table>
      <table depends="$panel_show$">
        <search>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="panel_show">true</set>
            </condition>
            <condition>
              <unset token="panel_show"></unset>
            </condition>
          </progress>
          <query>index=sag_common_hpbsm NAME_APPLICATION="armada" AVAILABILITY="0" 
| stats latest(_time) as Time latest(AVAILABILITY) as AVAILABILITY latest(RESPONSE_TIME) as RESPONSE_TIME  by NAME_APPLICATION, NAME_BTF, NAME_LOCATION,NAME_TRANSACTION 
| rename NAME_BTF as "Business process", NAME_TRANSACTION as "Transaction name",NAME_LOCATION as "Location name", NAME_APPLICATION as "Application name" 
| fields - RESPONSE_TIME 
| eval icon = "icon|" + if(AVAILABILITY=="0", "ico_error ico_small|icon-close|Down", "ico_good ico_small|icon-check|Up") 
| rename icon as " "

| convert ctime(Time) as Time</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="Application name">
          <colorPalette type="list">["#87ceeb"]</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel id="panel9">
      <title>Response Time and Availabilty metrics</title>
      <chart>
        <search>
          <query>index=*synthetic* 
| rex field=_raw "[^\,]+\,\"(?&lt;Application_Name&gt;[^\"]+)\"\,\"(?&lt;Availability&gt;[^\"]+)\"\,\"(?&lt;ResponseTime&gt;[^\"]+)"
| search Application_Name="armada"
| convert rmcomma(ResponseTime) 
| timechart span=10m latest(ResponseTime) as ResponseTime, latest(Availability) as Availability</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Response Time</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">1</option>
        <option name="charting.legend.labels">[Availability,ResponseTime]</option>
        <option name="charting.legend.placement">top</option>
        <option name="charting.seriesColors">[#AE2760,#2760AE]</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel id="panel10">
      <title>Response time trends for armada All Modules (min , max and avg)</title>
      <chart>
        <search>
          <query>index=sag_common_hpbsm NAME_APPLICATION="armada"  | timechart span=1h eval(round(max(RESPONSE_TIME),2)) as MAX_RESPONSE_TIME  ,eval(round(min(RESPONSE_TIME),2)) as MIN_RESPONSE_TIME,eval(round(avg(RESPONSE_TIME),2)) as AVG_RESPONSE_TIME by NAME_APPLICATION</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">top</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Process monitoring in windows</title>
      <input type="text" token="JobName">
        <label>Job Name</label>
        <default>*</default>
      </input>
      <table>
        <search>
          <query>index=sag_windows_normal armada Name="*$JobName$*"
| rename Name as JobName
| table * 
| eval CommandLine=mvindex(split(mvindex(mvindex(split(_raw,"CommandLine="),1),0),"StartTime="),0)

| fields Type, JobName, CommandLine, StartTime, Host, Path,ProcessId

| dedup Type, JobName, CommandLine, StartTime, Host, Path,ProcessId
| fields - _raw,_time</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">5</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="Type">
          <colorPalette type="list">[#dbf0f9]</colorPalette>
        </format>
        <format type="color" field="Host">
          <colorPalette type="list">[#dbf0f9]</colorPalette>
        </format>
        <format type="color" field="ProcessId">
          <colorPalette type="list">[#dbf0f9]</colorPalette>
        </format>
        <format type="color" field="JobName">
          <colorPalette type="list">[0xFFFF00]</colorPalette>
        </format>
      </table>
    </panel>
  </row>
</form>